# 实施计划

## 任务概述

本实施计划旨在增强实时录音与翻译界面的视觉样式，确保在浅色和深色主题下都有最佳的外观和可用性。

## 核心实施任务

- [x] 1. 代码审查与现状分析

  - **交付目标**: 全面了解当前样式实现和需要优化的具体区域
  - **交付内容**:
    - 审查 `resources/themes/light.qss` 中实时录音相关的现有样式
    - 审查 `resources/themes/dark.qss` 中实时录音相关的现有样式
    - 审查 `ui/realtime_record/widget.py` 中的 UI 组件结构和 objectName 定义
    - 识别需要修改的具体 QSS 选择器
    - 记录当前样式的问题点（对比度不足、视觉层次不清晰等）
    - 创建审查报告文档，列出所有需要修改的样式规则
  - _需求: 所有需求的前置条件_

- [x] 2. 更新浅色主题样式表

  - **交付目标**: 完成浅色主题下三个关键区域的视觉增强
  - **交付内容**:
    - 更新 `resources/themes/light.qss` 文件
    - 为 `QGroupBox#audio_input_group` 添加增强样式：
      - 背景色: `#f8f9fa` (极浅灰蓝色)
      - 边框: `1px solid #dee2e6`
      - 圆角: `8px`
      - 内边距: `16px`
      - 标题样式优化
    - 为 `QPlainTextEdit#transcription_text` 添加增强样式：
      - 背景色: `#ffffff` (纯白)
      - 文字色: `#212529` (接近黑色)
      - 边框: `2px solid #dee2e6`
      - 圆角: `6px`
      - 内边距: `12px`
      - 字体: 等宽字体，14px
      - 行高: `1.6`
      - 选中文本样式
    - 为 `QPlainTextEdit#translation_text` 添加增强样式：
      - 背景色: `#f8f9fa` (与转录区域略有区别)
      - 其他样式与转录区域保持一致
      - 禁用状态样式
    - 确保所有颜色组合符合 WCAG 2.1 AA 级对比度要求 (4.5:1)
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.3, 2.4, 2.6, 3.1, 3.3, 4.2_

- [x] 3. 更新深色主题样式表

  - **交付目标**: 完成深色主题下三个关键区域的视觉增强
  - **交付内容**:
    - 更新 `resources/themes/dark.qss` 文件
    - 为 `QGroupBox#audio_input_group` 添加增强样式：
      - 背景色: `#343a40` (深灰色)
      - 边框: `1px solid #495057`
      - 圆角: `8px`
      - 内边距: `16px`
      - 标题样式优化
    - 为 `QPlainTextEdit#transcription_text` 添加增强样式：
      - 背景色: `#212529` (极深灰色)
      - 文字色: `#e9ecef` (接近白色)
      - 边框: `2px solid #495057`
      - 圆角: `6px`
      - 内边距: `12px`
      - 字体: 等宽字体，14px
      - 行高: `1.6`
      - 选中文本样式
    - 为 `QPlainTextEdit#translation_text` 添加增强样式：
      - 背景色: `#2d2d2d` (与转录区域略有区别)
      - 其他样式与转录区域保持一致
      - 禁用状态样式
    - 确保所有颜色组合符合 WCAG 2.1 AA 级对比度要求
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.2, 2.3, 2.4, 2.6, 3.2, 3.4, 4.2_

- [x] 4. 添加焦点和交互状态样式

  - **交付目标**: 为所有交互元素添加清晰的视觉反馈
  - **交付内容**:
    - 在两个主题文件中添加焦点状态样式：
      - 转录文本框焦点: `border: 2px solid #0078d4`
      - 翻译文本框焦点: `border: 2px solid #0078d4`
      - 焦点时背景色微调（浅色主题: `#f8f9fa`, 深色主题: `#2d2d2d`）
    - 添加音频输入控件的悬停效果：
      - 下拉框悬停: `border: 1px solid #0078d4`
      - 滑块悬停: 手柄颜色加深
    - 添加翻译文本框的禁用状态样式：
      - 浅色主题: 背景 `#e9ecef`, 文字 `#6c757d`, 边框 `#ced4da`
      - 深色主题: 背景 `#1a1d20`, 文字 `#6c757d`, 边框 `#343a40`
    - 确保焦点指示器符合 3:1 对比度要求
  - _需求: 2.5, 3.2, 4.3, 5.3, 5.4_

- [x] 5. 实现自定义滚动条样式

  - **交付目标**: 为文本区域添加美观且易用的自定义滚动条
  - **交付内容**:
    - 为转录文本框添加自定义滚动条样式（两个主题）：
      - 滚动条宽度: `10px`
      - 滚动条背景: 浅色 `#f8f9fa` / 深色 `#2d2d2d`
      - 滚动条手柄: 浅色 `#adb5bd` / 深色 `#495057`
      - 手柄圆角: `5px`
      - 手柄最小高度: `30px`
      - 悬停效果: 浅色 `#6c757d` / 深色 `#6c757d`
    - 为翻译文本框添加相同的自定义滚动条样式
    - 确保滚动条手柄在两个主题下都清晰可见
    - 测试滚动条在长文本内容下的表现
  - _需求: 2.6, 3.4_

- [x] 6. 添加视觉状态指示器

  - **交付目标**: 为不同状态添加清晰的视觉反馈
  - **交付内容**:
    - 添加错误状态样式（两个主题）：
      - 选择器: `QPlainTextEdit#transcription_text[error="true"]`
      - 选择器: `QPlainTextEdit#translation_text[error="true"]`
      - 边框: `2px solid #dc3545` (红色)
    - 添加警告状态样式（两个主题）：
      - 选择器: `QPlainTextEdit#transcription_text[warning="true"]`
      - 选择器: `QPlainTextEdit#translation_text[warning="true"]`
      - 边框: `2px solid #fd7e14` (橙色)
    - 添加成功状态样式（两个主题）：
      - 选择器: `QPlainTextEdit#transcription_text[success="true"]`
      - 选择器: `QPlainTextEdit#translation_text[success="true"]`
      - 边框: `2px solid #28a745` (绿色)
    - 确保状态指示器在两个主题下都清晰可见
    - 在 QSS 文件中添加注释说明状态指示器的用途
  - _需求: 5.1, 5.2_

- [x] 7. 优化页面布局避免 UI 干涉
  - **交付目标**: 重新设计布局结构，避免 UI 元素相互堆叠和干涉
  - **交付内容**:
    - 将转录和翻译文本区域改为水平并排布局，避免垂直堆叠
    - 优化所有 GroupBox 的内边距和外边距，确保一致的间距
    - 为所有控件设置合理的最小/最大宽度，防止过度拉伸
    - 优化音频可视化组件的高度，避免占用过多空间
    - 统一所有 GroupBox 的样式，确保与其他页面保持一致
    - 调整 QSS 中的 margin 和 padding 值，消除不必要的空白
    - 为文本显示区域设置 stretch 因子，确保合理的空间分配
  - _需求: 布局优化，UI 一致性_

## 可选测试任务

- [ ]\* 7. 验证无障碍合规性

  - **交付目标**: 确保所有样式符合 WCAG 2.1 AA 级标准
  - **交付内容**:
    - 使用对比度检查工具（如 WebAIM Contrast Checker）测试所有文字/背景颜色组合
    - 验证普通文字对比度 ≥ 4.5:1
    - 验证大文字对比度 ≥ 3:1
    - 验证焦点指示器对比度 ≥ 3:1
    - 创建对比度测试报告，记录所有颜色组合的对比度值
    - 如发现不合规的颜色组合，调整并重新测试
  - _需求: 4.2_

- [ ]\* 8. 测试主题切换

  - **交付目标**: 确保主题切换功能正常且流畅
  - **交付内容**:
    - 启动应用，在浅色和深色主题之间切换多次
    - 验证所有样式元素正确更新
    - 验证没有布局偏移或闪烁
    - 在 macOS 上测试
    - 在 Windows 上测试（如有条件）
    - 记录任何发现的问题并修复
    - 创建测试报告，包含测试截图
  - _需求: 4.1, 4.4_

- [ ]\* 9. 测试视觉层次和间距

  - **交付目标**: 确保视觉层次清晰且间距一致
  - **交付内容**:
    - 使用浏览器开发工具或截图工具测量间距
    - 验证章节间距为 15-20px
    - 验证内部内边距为 12-16px
    - 验证边框圆角为 6-8px
    - 验证文本区域行高为 1.6
    - 在不同屏幕尺寸下测试（1920x1080, 2560x1440, 3840x2160）
    - 创建间距测试报告，包含测量结果
  - _需求: 4.5_

- [ ]\* 10. 测试交互状态

  - **交付目标**: 确保所有交互状态正常工作
  - **交付内容**:
    - 测试所有交互元素的焦点指示器
    - 测试音频输入控件的悬停效果
    - 测试翻译区域的禁用状态外观
    - 验证键盘导航正常工作（Tab 键切换焦点）
    - 使用屏幕阅读器测试（macOS 上的 VoiceOver 或 Windows 上的 NVDA）
    - 记录任何可访问性问题并修复
    - 创建交互测试报告
  - _需求: 4.3, 5.3, 5.4, 5.5_

- [ ]\* 11. 跨平台视觉测试

  - **交付目标**: 确保样式在不同平台上表现一致
  - **交付内容**:
    - 在 macOS 上测试不同显示分辨率
    - 在 Windows 上测试不同显示分辨率（如有条件）
    - 验证字体渲染在不同平台上一致
    - 验证颜色在不同显示器上显示正确
    - 测试系统深色模式启用/禁用时的表现
    - 创建跨平台测试报告，包含不同平台的截图对比
  - _需求: 4.4, 4.5_

- [ ]\* 12. 性能测试

  - **交付目标**: 确保样式更改不影响性能
  - **交付内容**:
    - 测试主题切换性能（应该是即时的）
    - 监控应用新样式后的内存使用情况
    - 测试文本区域在大量内容下的滚动流畅度
    - 使用性能分析工具（如 Qt Creator Profiler）检查 QSS 解析时间
    - 对比样式更改前后的性能指标
    - 创建性能测试报告
  - _需求: 设计约束 - 保持性能_

- [ ]\* 13. 文档和清理
  - **交付目标**: 完善文档，便于后续维护
  - **交付内容**:
    - 在 QSS 文件中添加详细注释，说明每个选择器的用途
    - 添加注释解释颜色选择的原因（如对比度、视觉层次）
    - 创建样式指南文档，说明颜色调色板和使用规则
    - 创建前后对比截图（浅色和深色主题各一组）
    - 更新相关用户文档（如有）
    - 创建 CHANGELOG 条目，记录样式更改
  - _需求: 所有需求（文档化）_
